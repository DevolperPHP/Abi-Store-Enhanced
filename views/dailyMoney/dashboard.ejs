<%- include("../layout/navbar") -%>

<!-- Modern Dashboard Container -->
<div class="daily-money-dashboard">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-icon">
                <ion-icon name="calendar-outline"></ion-icon>
            </div>
            <div class="header-text">
                <h1 class="dashboard-title">Daily Transactions</h1>
                <p class="dashboard-subtitle">Track and manage daily expenses and transactions</p>
            </div>
        </div>
        <div class="header-actions">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <ion-icon name="search-outline" class="search-icon"></ion-icon>
                    <input type="text" id="searchInput" placeholder="Search by date..." class="search-input">
                </div>
            </div>
            <button class="btn-primary" onclick="createNewTransaction()">
                <ion-icon name="add-outline"></ion-icon>
                New Transaction
            </button>
        </div>
    </div>

    <!-- Quick Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <ion-icon name="folder-outline"></ion-icon>
            </div>
            <div class="stat-content">
                <div class="stat-value"><%= dailyMoney.length%></div>
                <div class="stat-label">Total Records</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <ion-icon name="calendar-outline"></ion-icon>
            </div>
            <div class="stat-content">
                <div class="stat-value">
                    <% if (dailyMoney.length > 0) { %>
                        <%= new Date(dailyMoney[0].sortDate).toLocaleDateString() %>
                    <% } else { %>
                        No Records
                    <% } %>
                </div>
                <div class="stat-label">Latest Entry</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <ion-icon name="cash-outline"></ion-icon>
            </div>
            <div class="stat-content">
                <div class="stat-value">
                    <% 
                    let totalSum = 0;
                    dailyMoney.forEach(record => {
                        totalSum += record.total || 0;
                    });
                    %>
                    <%= totalSum.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")%> IQD
                </div>
                <div class="stat-label">Total Amount</div>
            </div>
        </div>
    </div>

    <!-- Error Message -->
    <% if(err.length > 0) {%>
        <div class="error-notification">
            <div class="error-content">
                <ion-icon name="alert-circle-outline"></ion-icon>
                <div class="error-text">
                    <h4>Transaction Already Exists</h4>
                    <p>You have already created a transaction record for today</p>
                </div>
            </div>
        </div>
    <%}%>

    <!-- Transactions Grid -->
    <div class="transactions-section">
        <div class="section-header">
            <h3 class="section-title">Transaction Records</h3>
            <div class="section-actions">
                <button class="btn-filter" onclick="toggleDateFilter()">
                    <ion-icon name="filter-outline"></ion-icon>
                    Filter
                </button>
                <button class="btn-export" onclick="exportData()">
                    <ion-icon name="download-outline"></ion-icon>
                    Export
                </button>
            </div>
        </div>

        <!-- Date Filter (Initially Hidden) -->
        <div class="date-filter" id="dateFilter" style="display: none;">
            <div class="filter-content">
                <div class="filter-group">
                    <label class="filter-label">From Date</label>
                    <input type="date" id="fromDate" class="filter-input">
                </div>
                <div class="filter-group">
                    <label class="filter-label">To Date</label>
                    <input type="date" id="toDate" class="filter-input">
                </div>
                <div class="filter-actions">
                    <button class="btn-secondary" onclick="clearFilters()">Clear</button>
                    <button class="btn-primary" onclick="applyFilters()">Apply</button>
                </div>
            </div>
        </div>

        <!-- Transaction Cards -->
        <div class="transactions-grid" id="transactionsGrid">
            <% if (dailyMoney.length === 0) { %>
                <div class="empty-state">
                    <div class="empty-icon">
                        <ion-icon name="folder-open-outline"></ion-icon>
                    </div>
                    <h3 class="empty-title">No Transaction Records</h3>
                    <p class="empty-description">Start by creating your first daily transaction record</p>
                    <button class="btn-primary" onclick="createNewTransaction()">
                        <ion-icon name="add-outline"></ion-icon>
                        Create First Record
                    </button>
                </div>
            <% } else { %>
                <% dailyMoney.forEach(data => { %>
                    <div class="transaction-card" data-date="<%= data.Date%>" onclick="window.location.href='/dailymoney/get/<%=data.id%>'">
                        <div class="card-header">
                            <div class="card-icon">
                                <ion-icon name="folder-outline"></ion-icon>
                            </div>
                            <div class="card-meta">
                                <h4 class="card-date"><%= data.Date%></h4>
                                <div class="card-subtitle">
                                    <%= data.purchase.length %> transaction<%= data.purchase.length !== 1 ? 's' : '' %>
                                </div>
                            </div>
                            <% if(data.status == "pending"){%>
                                <div class="status-badge pending">
                                    <ion-icon name="time-outline"></ion-icon>
                                    Pending
                                </div>
                            <%} %>
                        </div>
                        
                        <div class="card-content">
                            <div class="amount-section">
                                <div class="amount-label">Total Amount</div>
                                <div class="amount-value">
                                    <%= data.total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")%> IQD
                                </div>
                            </div>
                            
                            <div class="card-actions">
                                <button class="action-btn" onclick="event.stopPropagation(); editTransaction('<%= data.id%>')">
                                    <ion-icon name="create-outline"></ion-icon>
                                </button>
                                <button class="action-btn danger" onclick="event.stopPropagation(); deleteTransaction('<%= data.id%>', '<%= data.Date%>')">
                                    <ion-icon name="trash-outline"></ion-icon>
                                </button>
                            </div>
                        </div>
                        
                        <div class="card-footer">
                            <div class="transaction-preview">
                                <% if (data.purchase.length > 0) { %>
                                    <div class="recent-transactions">
                                        <span class="recent-label">Recent:</span>
                                        <span class="recent-item"><%= data.purchase[0].title%></span>
                                        <% if (data.purchase.length > 1) { %>
                                            <span class="more-items">+<%= data.purchase.length - 1 %> more</span>
                                        <% } %>
                                    </div>
                                <% } else { %>
                                    <span class="no-transactions">No transactions yet</span>
                                <% } %>
                            </div>
                            <div class="card-date-small">
                                <%= new Date(data.sortDate).toLocaleDateString('en-US', { 
                                    month: 'short', 
                                    day: 'numeric',
                                    year: 'numeric'
                                }) %>
                            </div>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>
</div>

<!-- Create Transaction Form (Hidden) -->
<form action="/dailymoney/new" method="post" id="createForm" style="display: none;">
</form>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" id="deleteModal" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Delete Transaction</h3>
            <button class="modal-close" onclick="closeDeleteModal()">
                <ion-icon name="close-outline"></ion-icon>
            </button>
        </div>
        <div class="modal-content">
            <p>Are you sure you want to delete the transaction record for <span id="deleteDate"></span>?</p>
            <p class="modal-warning">This action cannot be undone.</p>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <button class="btn-danger" id="confirmDelete">Delete</button>
        </div>
    </div>
</div>

<style>
    /* ===== DASHBOARD CONTAINER ===== */
    .daily-money-dashboard {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
        margin-left: 260px;
        margin-top: 40px;
    }

    /* ===== DASHBOARD HEADER ===== */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 32px;
        gap: 24px;
    }

    .header-content {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .header-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        background: linear-gradient(135deg, #007AFF, #5856D6);
        color: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .header-icon ion-icon {
        font-size: 28px;
    }

    .header-text {
        flex: 1;
    }

    .dashboard-title {
        font-size: 32px;
        font-weight: 700;
        color: #1d1d1f;
        margin: 0 0 8px 0;
        letter-spacing: -0.5px;
    }

    .dashboard-subtitle {
        font-size: 18px;
        color: #8e8e93;
        margin: 0;
        font-weight: 400;
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .search-container {
        position: relative;
    }

    .search-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }

    .search-icon {
        position: absolute;
        left: 12px;
        font-size: 18px;
        color: #8e8e93;
        z-index: 1;
    }

    .search-input {
        width: 280px;
        padding: 12px 16px 12px 44px;
        border: 1.5px solid #e5e5ea;
        border-radius: 12px;
        font-size: 16px;
        font-family: inherit;
        background: #ffffff;
        color: #1d1d1f;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        outline: none;
    }

    .search-input:focus {
        border-color: #007AFF;
        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .btn-primary {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        background: #007AFF;
        color: #ffffff;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        text-decoration: none;
    }

    .btn-primary:hover {
        background: #0056b3;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }

    .btn-primary ion-icon {
        font-size: 18px;
    }

    /* ===== STATS GRID ===== */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
    }

    .stat-card {
        background: #ffffff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        border: 1px solid rgba(0, 0, 0, 0.06);
        display: flex;
        align-items: center;
        gap: 16px;
        transition: transform 0.2s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: rgba(0, 122, 255, 0.1);
        color: #007AFF;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .stat-icon ion-icon {
        font-size: 24px;
    }

    .stat-content {
        flex: 1;
    }

    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: #1d1d1f;
        margin-bottom: 4px;
    }

    .stat-label {
        font-size: 14px;
        color: #8e8e93;
        font-weight: 500;
    }

    /* ===== ERROR NOTIFICATION ===== */
    .error-notification {
        background: rgba(255, 59, 48, 0.1);
        border: 1px solid rgba(255, 59, 48, 0.2);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 24px;
    }

    .error-content {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .error-content ion-icon {
        font-size: 24px;
        color: #FF3B30;
        flex-shrink: 0;
    }

    .error-text h4 {
        font-size: 16px;
        font-weight: 600;
        color: #1d1d1f;
        margin: 0 0 4px 0;
    }

    .error-text p {
        font-size: 14px;
        color: #8e8e93;
        margin: 0;
    }

    /* ===== TRANSACTIONS SECTION ===== */
    .transactions-section {
        background: #ffffff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        border: 1px solid rgba(0, 0, 0, 0.06);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #f0f0f0;
    }

    .section-title {
        font-size: 20px;
        font-weight: 600;
        color: #1d1d1f;
        margin: 0;
    }

    .section-actions {
        display: flex;
        gap: 12px;
    }

    .btn-filter,
    .btn-export {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        background: rgba(0, 0, 0, 0.04);
        color: #1d1d1f;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-filter:hover,
    .btn-export:hover {
        background: rgba(0, 0, 0, 0.08);
    }

    /* ===== DATE FILTER ===== */
    .date-filter {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
    }

    .filter-content {
        display: flex;
        align-items: end;
        gap: 20px;
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .filter-label {
        font-size: 13px;
        font-weight: 600;
        color: #8e8e93;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filter-input {
        padding: 10px 12px;
        border: 1.5px solid #e5e5ea;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        background: #ffffff;
        color: #1d1d1f;
        outline: none;
        transition: border-color 0.2s ease;
        min-width: 160px;
    }

    .filter-input:focus {
        border-color: #007AFF;
    }

    .filter-actions {
        display: flex;
        gap: 8px;
        margin-left: auto;
    }

    .btn-secondary {
        display: inline-flex;
        align-items: center;
        padding: 10px 16px;
        background: rgba(0, 0, 0, 0.04);
        color: #1d1d1f;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-secondary:hover {
        background: rgba(0, 0, 0, 0.08);
    }

    .btn-danger {
        display: inline-flex;
        align-items: center;
        padding: 10px 16px;
        background: #FF3B30;
        color: #ffffff;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-danger:hover {
        background: #d70015;
    }

    /* ===== EMPTY STATE ===== */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-icon {
        width: 80px;
        height: 80px;
        border-radius: 20px;
        background: rgba(0, 122, 255, 0.1);
        color: #007AFF;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
    }

    .empty-icon ion-icon {
        font-size: 40px;
    }

    .empty-title {
        font-size: 24px;
        font-weight: 600;
        color: #1d1d1f;
        margin: 0 0 8px 0;
    }

    .empty-description {
        font-size: 16px;
        color: #8e8e93;
        margin: 0 0 24px 0;
    }

    /* ===== TRANSACTIONS GRID ===== */
    .transactions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 20px;
    }

    .transaction-card {
        background: #ffffff;
        border: 1px solid #f0f0f0;
        border-radius: 16px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .transaction-card:hover {
        border-color: #007AFF;
        box-shadow: 0 4px 16px rgba(0, 122, 255, 0.1);
        transform: translateY(-2px);
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }

    .card-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(0, 122, 255, 0.1);
        color: #007AFF;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .card-icon ion-icon {
        font-size: 20px;
    }

    .card-meta {
        flex: 1;
    }

    .card-date {
        font-size: 16px;
        font-weight: 600;
        color: #1d1d1f;
        margin: 0 0 4px 0;
    }

    .card-subtitle {
        font-size: 13px;
        color: #8e8e93;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-badge.pending {
        background: rgba(255, 149, 0, 0.15);
        color: #FF9500;
    }

    .card-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .amount-section {
        text-align: left;
    }

    .amount-label {
        font-size: 12px;
        color: #8e8e93;
        margin-bottom: 4px;
    }

    .amount-value {
        font-size: 20px;
        font-weight: 700;
        color: #007AFF;
    }

    .card-actions {
        display: flex;
        gap: 8px;
    }

    .action-btn {
        width: 36px;
        height: 36px;
        border: none;
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.04);
        color: #8e8e93;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .action-btn:hover {
        background: rgba(0, 0, 0, 0.08);
        color: #1d1d1f;
    }

    .action-btn.danger:hover {
        background: rgba(255, 59, 48, 0.1);
        color: #FF3B30;
    }

    .action-btn ion-icon {
        font-size: 16px;
    }

    .card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 12px;
        border-top: 1px solid #f0f0f0;
    }

    .transaction-preview {
        flex: 1;
    }

    .recent-transactions {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
    }

    .recent-label {
        color: #8e8e93;
    }

    .recent-item {
        color: #1d1d1f;
        font-weight: 500;
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .more-items {
        color: #007AFF;
        font-weight: 500;
    }

    .no-transactions {
        color: #8e8e93;
        font-style: italic;
        font-size: 13px;
    }

    .card-date-small {
        font-size: 11px;
        color: #8e8e93;
        font-weight: 500;
    }

    /* ===== MODAL ===== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
    }

    .modal {
        background: #ffffff;
        border-radius: 16px;
        padding: 24px;
        max-width: 400px;
        width: 100%;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 16px;
        border-bottom: 1px solid #f0f0f0;
    }

    .modal-title {
        font-size: 18px;
        font-weight: 600;
        color: #1d1d1f;
        margin: 0;
    }

    .modal-close {
        width: 32px;
        height: 32px;
        border: none;
        background: none;
        color: #8e8e93;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s ease;
    }

    .modal-close:hover {
        background: rgba(0, 0, 0, 0.04);
        color: #1d1d1f;
    }

    .modal-content {
        margin-bottom: 24px;
    }

    .modal-content p {
        font-size: 16px;
        color: #1d1d1f;
        margin: 0 0 8px 0;
    }

    .modal-warning {
        color: #8e8e93;
        font-size: 14px;
    }

    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 1024px) {
        .daily-money-dashboard {
            padding: 20px 16px;
        }

        .dashboard-header {
            flex-direction: column;
            gap: 20px;
        }

        .header-actions {
            width: 100%;
            justify-content: space-between;
        }

        .search-input {
            width: 100%;
        }

        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
        }

        .transactions-grid {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }
    }

    @media (max-width: 768px) {
        .dashboard-title {
            font-size: 24px;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .filter-content {
            flex-direction: column;
            align-items: stretch;
        }

        .filter-actions {
            margin-left: 0;
            justify-content: stretch;
        }

        .filter-actions button {
            flex: 1;
        }

        .transactions-grid {
            grid-template-columns: 1fr;
        }

        .section-header {
            flex-direction: column;
            gap: 16px;
            align-items: stretch;
        }

        .section-actions {
            justify-content: stretch;
        }

        .section-actions button {
            flex: 1;
        }
    }
</style>

<script>
    function createNewTransaction() {
        document.getElementById('createForm').submit();
    }

    function toggleDateFilter() {
        const filter = document.getElementById('dateFilter');
        filter.style.display = filter.style.display === 'none' ? 'block' : 'none';
    }

    function clearFilters() {
        document.getElementById('fromDate').value = '';
        document.getElementById('toDate').value = '';
        filterTransactions('', '');
    }

    function applyFilters() {
        const fromDate = document.getElementById('fromDate').value;
        const toDate = document.getElementById('toDate').value;
        filterTransactions(fromDate, toDate);
    }

    function filterTransactions(fromDate, toDate) {
        const cards = document.querySelectorAll('.transaction-card');
        cards.forEach(card => {
            const cardDate = card.getAttribute('data-date');
            let show = true;

            if (fromDate && cardDate < fromDate) show = false;
            if (toDate && cardDate > toDate) show = false;

            card.style.display = show ? 'block' : 'none';
        });
    }

    // Search functionality
    document.getElementById('searchInput').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const cards = document.querySelectorAll('.transaction-card');
        
        cards.forEach(card => {
            const cardDate = card.getAttribute('data-date').toLowerCase();
            const shouldShow = cardDate.includes(searchTerm);
            card.style.display = shouldShow ? 'block' : 'none';
        });
    });

    function editTransaction(id) {
        window.location.href = '/dailymoney/get/' + id;
    }

    function deleteTransaction(id, date) {
        document.getElementById('deleteDate').textContent = date;
        document.getElementById('deleteModal').style.display = 'flex';
        
        document.getElementById('confirmDelete').onclick = function() {
            // Add delete functionality here
            fetch('/dailymoney/delete/' + id, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            }).then(() => {
                window.location.reload();
            });
        };
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }

    function exportData() {
        // Show loading state
        const btn = document.querySelector('.btn-export');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<ion-icon name="refresh-outline"></ion-icon> Exporting...';
        btn.disabled = true;
        
        // Create download link and trigger download
        const link = document.createElement('a');
        link.href = '/dailymoney/export-all';
        link.download = '';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Reset button after a short delay
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }, 2000);
    }

    // Close modal when clicking outside
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });
</script>

<%- include("../layout/footer") -%>